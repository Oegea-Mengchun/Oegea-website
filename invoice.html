<meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Oegea Invoice Generator</title>
<style>
body {font-family: Arial, sans-serif; background:#f7f7f7; margin:0; padding:0;}
.container {max-width:900px; margin:20px auto; background:#fff; padding:30px; border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,0.1);}
h1,h2 {text-align:center; margin-bottom:20px;}
label {display:block; margin-top:15px; font-weight:bold;}
input, select, textarea, button {width:100%; padding:8px; margin-top:5px; border-radius:4px; border:1px solid #ccc; box-sizing:border-box;}
table {width:100%; border-collapse:collapse; margin-top:20px;}
th, td {border:1px solid #ccc; padding:10px; text-align:center;}
th {background:#e0f0ff;}
.total-row td {font-weight:bold;}
.hidden {display:none;}
button {padding:10px; margin-top:10px; background:#007BFF; color:#fff; border:none; border-radius:6px; cursor:pointer;}
button:hover {background:#0056b3;}
</style>
</head>
<body>

<!-- 密码保护界面 -->
<div class="container" id="passwordContainer">
  <h1>Enter Password</h1>
  <input type="password" id="pagePassword" placeholder="Enter Password">
  <button onclick="checkPassword()">Unlock</button>
</div>

<!-- 主生成器界面 -->
<div class="container hidden" id="mainContent">
  <h1>INVOICE Generator</h1>

  <label>Invoice Number</label>
  <input type="text" id="invoiceNumber" readonly>

  <label>Invoice Date (Hong Kong Time)</label>
  <input type="text" id="invoiceDate" readonly>

  <h2>Seller Information</h2>
  <p>Oegea Pattern Studio<br>Email: support@oegea.site<br>Website: www.oegea.site</p>

  <h2>Customer Information</h2>
  <label>Customer Name</label>
  <input type="text" id="customerName">
  <label>Company</label>
  <input type="text" id="customerCompany">
  <label>Email</label>
  <input type="email" id="customerEmail">

  <h2>Invoice Items</h2>
  <table id="itemsTable">
    <thead>
      <tr>
        <th>Service</th>
        <th>Quantity</th>
        <th>Unit Price (USD)</th>
        <th>Subtotal</th>
      </tr>
    </thead>
    <tbody>
      <!-- 制版服务 -->
      <tr>
        <td>
          <select class="service" data-type="pattern">
            <option value="Basic Pattern">Basic Pattern</option>
            <option value="Medium Pattern">Medium Pattern</option>
            <option value="Complex Pattern">Complex Pattern</option>
          </select>
        </td>
        <td><input type="number" class="quantity" value="1" min="1"></td>
        <td><input type="number" class="unitPrice" value="0" min="0" step="0.01"></td>
        <td class="subtotal">0.00</td>
      </tr>
      <!-- 放码服务 -->
      <tr>
        <td>
          <select class="service" data-type="grading">
            <option value="Basic Grading">Basic Grading</option>
            <option value="Medium Grading">Medium Grading</option>
            <option value="Complex Grading">Complex Grading</option>
          </select>
        </td>
        <td><input type="number" class="quantity" value="1" min="1"></td>
        <td><input type="number" class="unitPrice" value="0" min="0" step="0.01"></td>
        <td class="subtotal">0.00</td>
      </tr>
      <!-- 其他服务 -->
      <tr>
        <td>
          <select class="service" data-type="other">
            <option value="Size Adjustment">Size Adjustment</option>
            <option value="Custom Request">Custom Request</option>
            <option value="Sample Garment Suggestions">Sample Garment Suggestions</option>
          </select>
        </td>
        <td><input type="number" class="quantity" value="1" min="1"></td>
        <td><input type="number" class="unitPrice" value="0" min="0" step="0.01"></td>
        <td class="subtotal">0.00</td>
      </tr>
    </tbody>
    <tfoot>
      <tr class="total-row">
        <td colspan="3">Total</td>
        <td id="totalAmount">0.00</td>
      </tr>
    </tfoot>
  </table>

  <label>Payment Terms</label>
  <input type="text" id="paymentTerms" value="50% upfront, 50% upon delivery">

  <h2>Payment Information</h2>
  <label>Payment Method</label>
  <input type="text" id="paymentMethod" value="PayPal">
  <label>Payment Account</label>
  <input type="text" id="paymentAccount" value="https://www.paypal.me/OegeaPatternStudio">
  <label>Payment Type</label>
  <select id="paymentType">
    <option value="deposit">Deposit</option>
    <option value="final">Final Payment</option>
  </select>
  <label>Payment Percentage</label>
  <input type="text" id="paymentPercentage" value="50%">

  <label>Notes / Remarks</label>
  <textarea id="notes" rows="4" placeholder="Other services require discussion"></textarea>

  <button onclick="generatePDF()">Generate PDF Invoice</button>

  <h2>Change Password</h2>
  <label>New Password</label>
  <input type="password" id="newPassword">
  <button onclick="changePassword()">Change Password</button>
</div>

<!-- jsPDF CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
// 密码功能
let pagePassword = '123456';
function checkPassword() {
  const input = document.getElementById('pagePassword').value;
  if(input === pagePassword){
    document.getElementById('passwordContainer').classList.add('hidden');
    document.getElementById('mainContent').classList.remove('hidden');
  } else { alert('Incorrect password!'); }
}
function changePassword(){
  const newPass = document.getElementById('newPassword').value;
  if(newPass){
    pagePassword = newPass;
    alert('Password changed!');
    document.getElementById('newPassword').value = '';
  }
}

// 发票号和日期
function generateInvoiceNumber() {
  return 'OE-' + Date.now();
}
function getHKTime() {
  const now = new Date();
  const utc = now.getTime() + now.getTimezoneOffset()*60000;
  const hk = new Date(utc + 8*3600000);
  return hk.toISOString().slice(0,10);
}
document.getElementById('invoiceNumber').value = generateInvoiceNumber();
document.getElementById('invoiceDate').value = getHKTime();

// 更新小计
function updateTotals() {
  let total = 0;
  document.querySelectorAll('#itemsTable tbody tr').forEach(row=>{
    const qty = parseFloat(row.querySelector('.quantity').value)||0;
    const price = parseFloat(row.querySelector('.unitPrice').value)||0;
    const subtotal = qty*price;
    row.querySelector('.subtotal').innerText = subtotal.toFixed(2);
    total += subtotal;
  });
  document.getElementById('totalAmount').innerText = total.toFixed(2);
}
document.querySelectorAll('.quantity, .unitPrice').forEach(input=>{
  input.addEventListener('input', updateTotals);
});
document.querySelectorAll('.service').forEach(select=>{
  select.addEventListener('change', updateTotals);
});
updateTotals();

// PDF生成
function generatePDF(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  // 标题
  doc.setFontSize(22);
  doc.setTextColor(0, 51, 153);
  doc.text("INVOICE", 105, 20, {align:"center"});

  doc.setFontSize(12);
  doc.setTextColor(0,0,0);
  let y = 30;
  doc.text(`Invoice No: ${document.getElementById('invoiceNumber').value}`, 14, y);
  doc.text(`Date: ${document.getElementById('invoiceDate').value}`, 150, y);
  y+=10;
  doc.text("Seller: Oegea Pattern Studio", 14, y);
  doc.text("Email: support@oegea.site", 14, y+6);
  doc.text("Website: www.oegea.site", 14, y+12);

  y+=24;
  doc.text(`Customer: ${document.getElementById('customerName').value}`, 14, y);
  doc.text(`Company: ${document.getElementById('customerCompany').value}`, 14, y+6);
  doc.text(`Email: ${document.getElementById('customerEmail').value}`, 14, y+12);

  y+=24;
  doc.autoTable({
    startY: y,
    head:[['Service','Quantity','Unit Price','Subtotal']],
    body: Array.from(document.querySelectorAll('#itemsTable tbody tr')).map(tr=>[
      tr.querySelector('.service').value,
      tr.querySelector('.quantity').value,
      tr.querySelector('.unitPrice').value,
      tr.querySelector('.subtotal').innerText
    ]),
    theme:'grid'
  });

  y = doc.lastAutoTable.finalY + 10;
  doc.text(`Total: $${document.getElementById('totalAmount').innerText}`, 150, y);

  y+=10;
  doc.text("Payment Information:", 14, y);
  y+=6;
  doc.text(`Method: ${document.getElementById('paymentMethod').value}`, 14, y);
  doc.text(`Account: ${document.getElementById('paymentAccount').value}`, 14, y+6);
  doc.text(`Payment Type: ${document.getElementById('paymentType').value}`, 14, y+12);
  doc.text(`Payment Percentage: ${document.getElementById('paymentPercentage').value}`, 14, y+18);

  y+=30;
  doc.text("Notes / Remarks:", 14, y);
  y+=6;
  doc.text(document.getElementById('notes').value, 14, y);

  // 页脚品牌
  doc.setFontSize(10);
  doc.setTextColor(100);
  doc.text("Oegea Pattern Studio - www.oegea.site", 105, 290, {align:'center'});

  doc.save(`Invoice_${document.getElementById('invoiceNumber').value}.pdf`);
}
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
</body>
</html>